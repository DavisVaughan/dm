---
title: "Relational data with dm: Cheat sheet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{cheatsheet}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE
)
```
<!--page1-->
> If you have more than one table, use dm.

<!--col1-->
## <i class="fa-solid fa-circle-plus"></i> Create dm...

### <i class="fa-solid fa-database"></i> from database: `dm_from_con()`

```{r}
create_figure <- function(class, src, alt, caption) {
  src <- sprintf("../man/figures/cheatsheet/%s", src)
  html <- sprintf('
  <figure class="%s">
            <img
              alt="%s"
              src="%s"
            />
            <figcaption>
              %s
            </figcaption>
          </figure>  
  ',
   class, alt, src, commonmark::markdown_html(caption) 
  )
  cat(html)
}
```


```{r, results='asis'}
create_figure(
  class = "right",
  alt = "diagram showing the transformation from left a database icon to right a dm object represented as three tables in a blue frame",
  src = "dm_from_con.svg",
  caption = "```\ncon <- DBI::dbConnect(...)
dm_from_con(con)\n```\n"
)
```

### <i class="fa-solid fa-table"></i> from data frames: `dm(df1, df2, ...)`

```{r, results='asis'}
create_figure(
  class = "right",
  alt = "diagram showing the transformation from left three data frames to right a dm object represented as three tables in a blue frame",
  src = "dm.svg",
  caption = "```\ndm(df1, df2, df3)\n```\n"
  
)
```
         
### <i class="fa-solid fa-diagram-project"></i> from dm: `dm(dm1, df1...)`

```{r, results='asis'}
create_figure(
  class = "right",
  alt = "diagram showing the transformation from left a dm with a data frame below to right a single dm object represented as three tables in a blue frame",
  src = "dm-df.svg",
  caption = "```\ndm(dm1, df1)\n```\n"
  
)
```

```{r, results='asis'}
create_figure(
  class = "right",
  alt = "diagram showing the transformation from left two dm objects to right a single dm object represented as three tables in a blue frame",
  src = "dm-dm.svg",
  caption = "```\ndm(dm1, dm2)\n```\n"
  
)
```        

### Add keys: `dm_add_pk()`, `dm_add_fk()`

**Automatic** for MariaDB, SQL Server, Postgres, and others.

#### <i class="fa-solid fa-key"></i> Primary keys

**Identify** potential primary keys:

- `dm_enum_pk_candidates()`: columns, candidate, why.

```{r, results='asis'}
create_figure(
  class = "right",
  alt = "left a single dm object represented as three tables in a blue frame, right the same but with markers for primary keys",
  src = "primary-keys.svg",
  caption = "**Add** primary keys:\n\n```\ndm1 |>
  dm_add_pk(table, columns)\n```\n"
  
)
```        


**Identify** potential foreign keys:

- `dm_enum_fk_candidates()`: columns, candidate, why.

```{r, results='asis'}
create_figure(
  class = "right",
  alt = "left a single dm object represented as three tables in a blue frame, right the same but with an arrow to indicate a foreign key relationship",
  src = "fk.svg",
  caption = "**Add** foreign keys:\n\n```\ndm1 |>
  dm_add_fk(table, column)\n```\n"
  
)
``` 
<!--end-col1-->
<!--col2-->
<!--end-col2-->
<!--col3-->
<!--end-col3-->
<!--end-page1-->
