<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Defining a 'dm' object for your data • dm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Defining a 'dm' object for your data">
<meta property="og:description" content="dm">
<meta property="og:image" content="https://krlmlr.github.io/dm/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dm</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.1.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/dm.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dm-introduction-relational-data-models.html">Introduction to Relational Data Models</a>
    </li>
    <li>
      <a href="../articles/dm-class-and-basic-operations.html">Class 'dm' and basic operations</a>
    </li>
    <li>
      <a href="../articles/dm-visualization.html">Visualizing 'dm' objects</a>
    </li>
    <li>
      <a href="../articles/dm-joining.html">Joining in Relational Data Models</a>
    </li>
    <li>
      <a href="../articles/dm-zoom-to-table.html">Zooming and manipulating tables</a>
    </li>
    <li>
      <a href="../articles/dm-filtering.html">Filtering in Relational Data Models</a>
    </li>
    <li>
      <a href="../articles/dm-setup.html">Defining a 'dm' object for your data</a>
    </li>
    <li>
      <a href="../articles/dm-low-level.html">Low level operations</a>
    </li>
    <li>
      <a href="../articles/dm-function-naming-logic.html">Function naming logic</a>
    </li>
    <li>
      <a href="../articles/dm-version-migration-guide.html">Migration guide: 'cdm' -&gt; 'dm'</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/krlmlr/dm">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Defining a ‘dm’ object for your data</h1>
            
            <h4 class="date">2020-04-13</h4>
      
      
      <div class="hidden name"><code>dm-setup.Rmd</code></div>

    </div>

    
    
<p>This document describes how you can get your data into a <code>dm</code> object.</p>
<p>Although the example that we will be using is included in <code>dm</code>, and you can see it by running <code><a href="../reference/dm_nycflights13.html">dm_nycflights13()</a></code>, we will be going through the built-in example one more time here, step by step.</p>
<p>The five tables that we are working with contain information about all flights that departed from the airports of New York to other destinations in the United States in 2013, and are available through the <a href="https://github.com/hadley/nycflights13"><code>nycflights13</code></a> package:</p>
<ul>
<li>
<code>flights</code> represents the trips taken by planes</li>
<li>
<code>airlines</code> includes
<ul>
<li>the names of transport organizations (<code>name</code>)</li>
<li>their abbreviated codes (<code>carrier</code>)</li>
</ul>
</li>
<li>
<code>airports</code> indicates the ports of departure (<code>origin</code>) and of destination (<code>dest</code>)</li>
<li>
<code>weather</code> contains meterological information at each hour</li>
<li>
<code>planes</code> describes characteristics of aircrafts</li>
</ul>
<p>Once we’ve loaded <code>nycflights13</code>, the aforementioned tables are all in our work environment, ready to be accessed.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dm</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">nycflights13</span>)</pre></body></html></div>
<div id="adding-tables" class="section level1">
<h1 class="hasAnchor">
<a href="#adding-tables" class="anchor"></a>Adding Tables</h1>
<p>First, we will tell <code>dm</code> which tables we want to work with and how they are connected. For that, we can use <code>dm</code> or <code><a href="../reference/dm.html">as_dm()</a></code>, which accepts lists of objects. You must explicitly name the objects if you use <code><a href="https://rdrr.io/r/base/list.html">list()</a></code> (e.g., <code><a href="https://rdrr.io/r/base/list.html">list("airlines" = airlines, "flights" = flights)</a></code>) — here we use <code><a href="https://tibble.tidyverse.org/reference/lst.html">tibble::lst()</a></code>, which automatically names the components of the list.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">flights_dm_no_keys</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/lst.html">lst</a></span>(<span class="no">airlines</span>, <span class="no">airports</span>, <span class="no">flights</span>, <span class="no">planes</span>, <span class="no">weather</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dm.html">as_dm</a></span>()</pre></body></html></div>
</div>
<div id="defining-keys" class="section level1">
<h1 class="hasAnchor">
<a href="#defining-keys" class="anchor"></a>Defining Keys</h1>
<p>Even though you now have a new <code>dm</code> object that contains all your data, some key details are still missing that determine how your five tables are connected (the foreign keys), and which column(s) uniquely identify the observations (the primary keys).</p>
<div id="primary-keys" class="section level2">
<h2 class="hasAnchor">
<a href="#primary-keys" class="anchor"></a>Primary Keys</h2>
<p><code>dm</code> offers <code><a href="../reference/enum_pk_candidates.html">dm_enum_pk_candidates()</a></code> to identify primary keys and <code><a href="../reference/dm_add_pk.html">dm_add_pk()</a></code> to add them.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/enum_pk_candidates.html">dm_enum_pk_candidates</a></span>(
  <span class="kw">dm</span> <span class="kw">=</span> <span class="no">flights_dm_no_keys</span>,
  <span class="kw">table</span> <span class="kw">=</span> <span class="no">planes</span>
)</pre></body></html></div>
<pre><code>## # A tibble: 9 x 3
##   columns     candidate why                                                     
##   &lt;keys&gt;      &lt;lgl&gt;     &lt;chr&gt;                                                   
## 1 tailnum     TRUE      ""                                                      
## 2 engine      FALSE     "has duplicate values: 4 Cycle, Reciprocating, Turbo-fa…
## 3 engines     FALSE     "has duplicate values: 1, 2, 3, 4"                      
## 4 manufactur… FALSE     "has duplicate values: AIRBUS, AIRBUS INDUSTRIE, AMERIC…
## 5 model       FALSE     "has duplicate values: 717-200, 737-301, 737-3G7, 737-3…
## 6 seats       FALSE     "has duplicate values: 2, 4, 5, 6, 7, … (&gt;= 7 total)"   
## 7 speed       FALSE     "has duplicate values: 90, 105, 162, 432, NA"           
## 8 type        FALSE     "has duplicate values: Fixed wing multi engine, Fixed w…
## 9 year        FALSE     "has duplicate values: 1959, 1963, 1975, 1976, 1977, … …</code></pre>
<p>Now, add the primary keys that you have identified:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">flights_dm_only_pks</span> <span class="kw">&lt;-</span> <span class="no">flights_dm_no_keys</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dm_add_pk.html">dm_add_pk</a></span>(<span class="kw">table</span> <span class="kw">=</span> <span class="no">airlines</span>, <span class="kw">column</span> <span class="kw">=</span> <span class="no">carrier</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dm_add_pk.html">dm_add_pk</a></span>(<span class="no">airports</span>, <span class="no">faa</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dm_add_pk.html">dm_add_pk</a></span>(<span class="no">planes</span>, <span class="no">tailnum</span>)
<span class="no">flights_dm_only_pks</span></pre></body></html></div>
<pre><code>## ── Table source ────────────────────────────────────────────────────────────────
## src:  &lt;environment: R_GlobalEnv&gt;
## ── Metadata ────────────────────────────────────────────────────────────────────
## Tables: `airlines`, `airports`, `flights`, `planes`, `weather`
## Columns: 53
## Primary keys: 3
## Foreign keys: 0</code></pre>
<p>To review the primary keys after setting them, call <code><a href="../reference/dm_get_all_pks.html">dm_get_all_pks()</a></code>.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="../reference/dm_get_all_pks.html">dm_get_all_pks</a></span>(<span class="no">flights_dm_only_pks</span>)</pre></body></html></div>
<pre><code>## # A tibble: 3 x 2
##   table    pk_col 
##   &lt;chr&gt;    &lt;keys&gt; 
## 1 airlines carrier
## 2 airports faa    
## 3 planes   tailnum</code></pre>
</div>
<div id="foreign-keys" class="section level2">
<h2 class="hasAnchor">
<a href="#foreign-keys" class="anchor"></a>Foreign Keys</h2>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/dm_enum_fk_candidates.html">dm_enum_fk_candidates</a></span>(
  <span class="kw">dm</span> <span class="kw">=</span> <span class="no">flights_dm_only_pks</span>,
  <span class="kw">table</span> <span class="kw">=</span> <span class="no">flights</span>,
  <span class="kw">ref_table</span> <span class="kw">=</span> <span class="no">airlines</span>
)</pre></body></html></div>
<pre><code>## # A tibble: 19 x 3
##    columns      candidate why                                                   
##    &lt;keys&gt;       &lt;lgl&gt;     &lt;chr&gt;                                                 
##  1 carrier      TRUE      ""                                                    
##  2 tailnum      FALSE     "334264 entries (99.3%) of `flights$tailnum` not in `…
##  3 dest         FALSE     "336776 entries (100%) of `flights$dest` not in `airl…
##  4 origin       FALSE     "336776 entries (100%) of `flights$origin` not in `ai…
##  5 air_time     FALSE     "Can't join on 'value' x 'value' because of incompati…
##  6 arr_delay    FALSE     "Can't join on 'value' x 'value' because of incompati…
##  7 arr_time     FALSE     "Can't join on 'value' x 'value' because of incompati…
##  8 day          FALSE     "Can't join on 'value' x 'value' because of incompati…
##  9 dep_delay    FALSE     "Can't join on 'value' x 'value' because of incompati…
## 10 dep_time     FALSE     "Can't join on 'value' x 'value' because of incompati…
## 11 distance     FALSE     "Can't join on 'value' x 'value' because of incompati…
## 12 flight       FALSE     "Can't join on 'value' x 'value' because of incompati…
## 13 hour         FALSE     "Can't join on 'value' x 'value' because of incompati…
## 14 minute       FALSE     "Can't join on 'value' x 'value' because of incompati…
## 15 month        FALSE     "Can't join on 'value' x 'value' because of incompati…
## 16 sched_arr_t… FALSE     "Can't join on 'value' x 'value' because of incompati…
## 17 sched_dep_t… FALSE     "Can't join on 'value' x 'value' because of incompati…
## 18 time_hour    FALSE     "cannot join a POSIXct object with an object that is …
## 19 year         FALSE     "Can't join on 'value' x 'value' because of incompati…</code></pre>
<p>To define how your tables are related, use <code><a href="../reference/dm_add_fk.html">dm_add_fk()</a></code> to add foreign keys. First, define the tables that you wish to connect by parameterizing the <code><a href="../reference/dm_add_fk.html">dm_add_fk()</a></code> function with <code>table</code> and <code>ref_table</code> options.</p>
<p>Then indicate in <code>column</code> which column of <code>table</code> refers to <code>ref_table</code>’s primary key, which you’ve defined above. Use <code>check = FALSE</code> to omit consistency checks.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">flights_dm_all_keys</span> <span class="kw">&lt;-</span> <span class="no">flights_dm_only_pks</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dm_add_fk.html">dm_add_fk</a></span>(<span class="kw">table</span> <span class="kw">=</span> <span class="no">flights</span>, <span class="kw">column</span> <span class="kw">=</span> <span class="no">tailnum</span>, <span class="kw">ref_table</span> <span class="kw">=</span> <span class="no">planes</span>, <span class="kw">check</span> <span class="kw">=</span> <span class="fl">FALSE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dm_add_fk.html">dm_add_fk</a></span>(<span class="no">flights</span>, <span class="no">carrier</span>, <span class="no">airlines</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dm_add_fk.html">dm_add_fk</a></span>(<span class="no">flights</span>, <span class="no">origin</span>, <span class="no">airports</span>)
<span class="no">flights_dm_all_keys</span></pre></body></html></div>
<pre><code>## ── Table source ────────────────────────────────────────────────────────────────
## src:  &lt;environment: R_GlobalEnv&gt;
## ── Metadata ────────────────────────────────────────────────────────────────────
## Tables: `airlines`, `airports`, `flights`, `planes`, `weather`
## Columns: 53
## Primary keys: 3
## Foreign keys: 3</code></pre>
</div>
<div id="retrieving-keys" class="section level2">
<h2 class="hasAnchor">
<a href="#retrieving-keys" class="anchor"></a>Retrieving Keys</h2>
<p>To retrieve your keys later on, use <code><a href="../reference/dm_get_all_fks.html">dm_get_all_fks()</a></code>, or <code><a href="../reference/dm_get_fk.html">dm_get_fk()</a></code> for its singular version.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/dm_get_all_pks.html">dm_get_all_pks</a></span>(<span class="no">flights_dm_all_keys</span>)</pre></body></html></div>
<pre><code>## # A tibble: 3 x 2
##   table    pk_col 
##   &lt;chr&gt;    &lt;keys&gt; 
## 1 airlines carrier
## 2 airports faa    
## 3 planes   tailnum</code></pre>
<p>Voilà, here’s your <code>dm</code> object that you can work with:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">flights_dm_all_keys</span></pre></body></html></div>
<pre><code>## ── Table source ────────────────────────────────────────────────────────────────
## src:  &lt;environment: R_GlobalEnv&gt;
## ── Metadata ────────────────────────────────────────────────────────────────────
## Tables: `airlines`, `airports`, `flights`, `planes`, `weather`
## Columns: 53
## Primary keys: 3
## Foreign keys: 3</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Tobias Schieferdecker, <a href="http://krlmlr.info">Kirill Müller</a>, Darko Bergant, <a href="https://www.energie360.ch"><img src="https://krlmlr.github.io/dm/reference/figures/energie-72.png" height="16"></a>, <a href="https://www.cynkra.com"><img src="https://krlmlr.github.io/dm/reference/figures/cynkra-72.png" height="16"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
