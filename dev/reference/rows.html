<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Manipulate individual rows — rows • dm</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Manipulate individual rows — rows" />
<meta property="og:description" content="
These functions provide a framework for modifying rows in a table using
a second table of data. The two tables are matched by a set of key
variables whose values must uniquely identify each row. The functions are
inspired by SQL's INSERT, UPDATE, and DELETE, and can optionally
modify in_place for selected backends.
rows_insert() adds new rows (like INSERT); key values in y must
not occur in x.
rows_update() modifies existing rows (like UPDATE); key values in
y must occur in x.
rows_patch() works like rows_update() but only overwrites NA values.
rows_upsert() inserts or updates depending on whether or not the
key value in y already exists in x.
rows_delete() deletes rows (like DELETE); key values in y must
exist in x.

" />
<meta property="og:image" content="https://krlmlr.github.io/dm/logo.png" />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dm</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.3.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/dm.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/howto-dm-db.html">Create a dm object from a database</a>
    </li>
    <li>
      <a href="../articles/howto-dm-df.html">Create a dm object from data frames</a>
    </li>
    <li>
      <a href="../articles/howto-dm-theory.html">Introduction to relational data models</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Technical articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/tech-dm-join.html">Joining in relational data models</a>
    </li>
    <li>
      <a href="../articles/tech-dm-zoom.html">Zooming and manipulating tables</a>
    </li>
    <li>
      <a href="../articles/tech-dm-filter.html">Filtering in relational data models</a>
    </li>
    <li>
      <a href="../articles/tech-dm-draw.html">Visualizing dm objects</a>
    </li>
    <li>
      <a href="../articles/tech-dm-low-level.html">Model verification - keys, constraints and normalization</a>
    </li>
    <li>
      <a href="../articles/tech-dm-class.html">Class 'dm' and basic operations</a>
    </li>
    <li>
      <a href="../articles/tech-dm-naming.html">Function naming logic</a>
    </li>
    <li>
      <a href="../articles/tech-dm-cdm.html">Migration guide: 'cdm' -&gt; 'dm'</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/krlmlr/dm">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Manipulate individual rows</h1>
    <small class="dont-index">Source: <a href='https://github.com/krlmlr/dm/blob/master/R/rows.R'><code>R/rows.R</code></a></small>
    <div class="hidden name"><code>rows.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><a href='https://www.tidyverse.org/lifecycle/#experimental'><img src='figures/lifecycle-experimental.svg' alt='Experimental lifecycle'></a></p>
<p>These functions provide a framework for modifying rows in a table using
a second table of data. The two tables are matched <code>by</code> a set of key
variables whose values must uniquely identify each row. The functions are
inspired by SQL's <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code>, and can optionally
modify <code>in_place</code> for selected backends.</p><ul>
<li><p><code>rows_insert()</code> adds new rows (like <code>INSERT</code>); key values in <code>y</code> must
not occur in <code>x</code>.</p></li>
<li><p><code>rows_update()</code> modifies existing rows (like <code>UPDATE</code>); key values in
<code>y</code> must occur in <code>x</code>.</p></li>
<li><p><code>rows_patch()</code> works like <code>rows_update()</code> but only overwrites <code>NA</code> values.</p></li>
<li><p><code>rows_upsert()</code> inserts or updates depending on whether or not the
key value in <code>y</code> already exists in <code>x</code>.</p></li>
<li><p><code>rows_delete()</code> deletes rows (like <code>DELETE</code>); key values in <code>y</code> must
exist in <code>x</code>.</p></li>
</ul>

    </div>

    <pre class="usage"><span class='fu'>rows_insert</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>in_place</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>rows_update</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>in_place</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>rows_patch</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>in_place</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>rows_upsert</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>in_place</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>rows_delete</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>in_place</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x, y</th>
      <td><p>A pair of data frames or data frame extensions (e.g. a tibble).
<code>y</code> must have the same columns of <code>x</code> or a subset.</p></td>
    </tr>
    <tr>
      <th>by</th>
      <td><p>An unnamed character vector giving the key columns. The key
values must uniquely identify each row (i.e. each combination of key
values occurs at most once), and the key columns must exist in both <code>x</code>
and <code>y</code>.</p>
<p>By default, we use the first column in <code>y</code>, since the first column is
a reasonable place to put an identifier variable.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>other parameters passed onto methods, for instance, <code>na_matches</code>
to control how <code>NA</code> values are matched.  See <a href='https://dplyr.tidyverse.org/reference/join.tbl_df.html'>join.tbl_df</a> for more.</p></td>
    </tr>
    <tr>
      <th>copy</th>
      <td><p>If <code>x</code> and <code>y</code> are not from the same data source,
and <code>copy</code> is <code>TRUE</code>, then <code>y</code> will be copied into the
same src as <code>x</code>.  This allows you to join tables across srcs, but
it is a potentially expensive operation so you must opt into it.</p></td>
    </tr>
    <tr>
      <th>in_place</th>
      <td><p>Should <code>x</code> be modified in place? This argument is only
relevant for mutable backends (e.g. databases, data.tables).</p>
<p>When <code>TRUE</code>, a modified version of <code>x</code> is returned invisibly;
when <code>FALSE</code>, a new object representing the resulting changes is returned.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of the same type as <code>x</code>. The order of the rows and columns of <code>x</code>
is preserved as much as possible. The output has the following properties:</p><ul>
<li><p><code>rows_update()</code> preserves rows as is; <code>rows_insert()</code> and <code>rows_upsert()</code>
return all existing rows and potentially new rows; <code>rows_delete()</code> returns
a subset of the rows.</p></li>
<li><p>Columns are not added, removed, or relocated, though the data may be updated.</p></li>
<li><p>Groups are taken from <code>x</code>.</p></li>
<li><p>Data frame attributes are taken from <code>x</code>.</p></li>
</ul>

<p>If <code>in_place = TRUE</code>, the result will be returned invisibly.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>data</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>3</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='no'>letters</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>2</span>, <span class='fl'>NA</span>)], <span class='kw'>c</span> <span class='kw'>=</span> <span class='fl'>0.5</span> + <span class='fl'>0</span>:<span class='fl'>2</span>)
<span class='no'>data</span></div><div class='output co'>#&gt; # A tibble: 3 x 3
#&gt;       a b         c
#&gt;   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5
#&gt; 2     2 b       1.5
#&gt; 3     3 &lt;NA&gt;    2.5</div><div class='input'>
<span class='co'># Insert</span>
<span class='fu'>rows_insert</span>(<span class='no'>data</span>, <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>4</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='st'>"z"</span>))</div><div class='output co'>#&gt; <span class='message'>Matching, by = "a"</span></div><div class='output co'>#&gt; # A tibble: 4 x 3
#&gt;       a b         c
#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5
#&gt; 2     2 b       1.5
#&gt; 3     3 &lt;NA&gt;    2.5
#&gt; 4     4 z      NA  </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/try.html'>try</a></span>(<span class='fu'>rows_insert</span>(<span class='no'>data</span>, <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='st'>"z"</span>)))</div><div class='output co'>#&gt; <span class='message'>Matching, by = "a"</span></div><div class='output co'>#&gt; Error : Attempting to insert duplicate rows.</div><div class='input'>
<span class='co'># Update</span>
<span class='fu'>rows_update</span>(<span class='no'>data</span>, <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>2</span>:<span class='fl'>3</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='st'>"z"</span>))</div><div class='output co'>#&gt; <span class='message'>Matching, by = "a"</span></div><div class='output co'>#&gt; # A tibble: 3 x 3
#&gt;       a b         c
#&gt;   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5
#&gt; 2     2 z       1.5
#&gt; 3     3 z       2.5</div><div class='input'><span class='fu'>rows_update</span>(<span class='no'>data</span>, <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>b</span> <span class='kw'>=</span> <span class='st'>"z"</span>, <span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>2</span>:<span class='fl'>3</span>), <span class='kw'>by</span> <span class='kw'>=</span> <span class='st'>"a"</span>)</div><div class='output co'>#&gt; # A tibble: 3 x 3
#&gt;       a b         c
#&gt;   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5
#&gt; 2     2 z       1.5
#&gt; 3     3 z       2.5</div><div class='input'>
<span class='co'># Variants: patch and upsert</span>
<span class='fu'>rows_patch</span>(<span class='no'>data</span>, <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>2</span>:<span class='fl'>3</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='st'>"z"</span>))</div><div class='output co'>#&gt; <span class='message'>Matching, by = "a"</span></div><div class='output co'>#&gt; # A tibble: 3 x 3
#&gt;       a b         c
#&gt;   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5
#&gt; 2     2 b       1.5
#&gt; 3     3 z       2.5</div><div class='input'><span class='fu'>rows_upsert</span>(<span class='no'>data</span>, <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>2</span>:<span class='fl'>4</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='st'>"z"</span>))</div><div class='output co'>#&gt; <span class='message'>Matching, by = "a"</span></div><div class='output co'>#&gt; # A tibble: 4 x 3
#&gt;       a b         c
#&gt;   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5
#&gt; 2     2 z       1.5
#&gt; 3     3 z       2.5
#&gt; 4     4 z      NA  </div><div class='input'>
<span class='co'># Delete and truncate</span>
<span class='fu'>rows_delete</span>(<span class='no'>data</span>, <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>2</span>:<span class='fl'>3</span>))</div><div class='output co'>#&gt; <span class='message'>Matching, by = "a"</span></div><div class='output co'>#&gt; # A tibble: 1 x 3
#&gt;       a b         c
#&gt;   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5</div><div class='input'><span class='fu'>rows_delete</span>(<span class='no'>data</span>, <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>2</span>:<span class='fl'>3</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='st'>"b"</span>))</div><div class='output co'>#&gt; <span class='message'>Matching, by = "a"</span></div><div class='output co'>#&gt; <span class='message'>Ignoring extra columns: b</span></div><div class='output co'>#&gt; # A tibble: 1 x 3
#&gt;       a b         c
#&gt;   &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1 a       0.5</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/try.html'>try</a></span>(<span class='fu'>rows_delete</span>(<span class='no'>data</span>, <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>2</span>:<span class='fl'>3</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='st'>"b"</span>), <span class='kw'>by</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"a"</span>, <span class='st'>"b"</span>)))</div><div class='output co'>#&gt; Error : Attempting to delete missing rows.</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Tobias Schieferdecker, <a href='http://krlmlr.info'>Kirill Müller</a>, Darko Bergant, <a href='https://www.energie360.ch'><img src="https://krlmlr.github.io/dm/reference/figures/energie-72.png" height="16"/></a>, <a href='https://www.cynkra.com'><img src="https://krlmlr.github.io/dm/reference/figures/cynkra-72.png" height="16"/></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


